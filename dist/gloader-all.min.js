function createDFS(e,t,n){var o=[],r={};return function s(i){r[i]=!0,o.push(i),e[i].forEach(function(e){if(r[e]){if(o.indexOf(e)>=0)throw o.push(e),new Error("Dependency Cycle Found: "+o.join(" -> "))}else s(e)}),o.pop(),t&&0!==e[i].length||-1!==n.indexOf(i)||n.push(i)}}var DepGraph=function(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}};"undefined"!=typeof exports&&(exports.DepGraph=DepGraph),DepGraph.prototype={addNode:function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},removeNode:function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var o=t[n].indexOf(e);o>=0&&t[n].splice(o,1)},this)}))},hasNode:function(e){return this.nodes.hasOwnProperty(e)},getNodeData:function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},setNodeData:function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},addDependency:function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},removeDependency:function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},dependenciesOf:function(e,t){if(this.hasNode(e)){var n=[];createDFS(this.outgoingEdges,t,n)(e);var o=n.indexOf(e);return o>=0&&n.splice(o,1),n}throw new Error("Node does not exist: "+e)},dependantsOf:function(e,t){if(this.hasNode(e)){var n=[];createDFS(this.incomingEdges,t,n)(e);var o=n.indexOf(e);return o>=0&&n.splice(o,1),n}throw new Error("Node does not exist: "+e)},overallOrder:function(e){var t=this,n=[],o=Object.keys(this.nodes);if(0===o.length)return n;var r=createDFS(this.outgoingEdges,!1,[]);o.forEach(function(e){r(e)});var s=createDFS(this.outgoingEdges,e,n);return o.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){s(e)}),n},steps:function(){var e=this,t=[],n={},o=function(r,s){var i,a,c,d,h,u=s+1;for(a=!0,c=0,d=e.incomingEdges[r].length;c<d;c++)i=e.incomingEdges[r][c],n.hasOwnProperty(i)?n[i]>u&&(u=n[i]+1):a=!1;if(a)for(t[u]||(t[u]=[]),t[u].push(r),n[r]=u,c=0,d=e.outgoingEdges[r].length;c<d;c++)h=e.outgoingEdges[r][c],o.call(e,h,u)};if((t=e.overallOrder()).length){t=[];for(var r in e.incomingEdges)e.incomingEdges.hasOwnProperty(r)&&(e.incomingEdges[r].length||o.call(e,r,-1))}return t}};var GLoader=function(){"use strict";this.graph=new DepGraph,this.validTypes=["js","css"]};"undefined"!=typeof exports&&(exports.GLoader=GLoader),GLoader.prototype={addScript:function(e,t,n){"use strict";return this.addResource(e,t,"js",n)},addStylesheet:function(e,t,n){"use strict";return this.addResource(e,t,"css",n)},addResource:function(e,t,n,o){"use strict";if(!e)throw new Error("id was empty");if("string"!=typeof e)throw new Error("id was not a string");if(!t)throw new Error("data was empty for script #"+e);if("object"!=typeof t)throw new Error("data was not an object for #"+e);if(!t.url||"string"!=typeof t.url)throw new Error("data.url was not a string for #"+e);if(t.fallback&&"string"!=typeof t.fallback)throw new Error("data.fallback was not a string for #"+e);if(!n)throw new Error("type cannot be empty for #"+e);if("string"!=typeof n)throw new Error("type was not a string for #"+e);if(-1==this.validTypes.indexOf(n))throw new Error("type was not a valid value for #"+e);return t.type=n,t.callback=o,this.graph.addNode(e,t)},removeResource:function(e){"use strict";return this.graph.removeNode(e)},hasResource:function(e){"use strict";return this.graph.hasNode(e)},addDependency:function(e,t){"use strict";return this.graph.addDependency(e,t)},removeDependency:function(e,t){"use strict";return this.graph.removeDependency(idfrom,idto)},getData:function(e){"use strict";return this.graph.getNodeData(e)},loadResource:function(e){"use strict";var t=this;return new Promise(function(n,o){var r,s,i=t.getData(e),a=i.url,c=i.type,d=i.callback,h=!1;"js"==c?(r=document.getElementsByTagName("script")[0],(s=document.createElement("script")).type="text/javascript",s.src=a,s.defer=!0):"css"==c&&((s=document.createElement("link")).type="text/css",s.rel="stylesheet",s.href=a),s.onload=s.onreadystatechange=function(){h||this.readyState&&"complete"!=this.readyState||(h=!0,n(this),"function"==typeof d?d.call(this):"object"==typeof d&&"function"==typeof d.fn&&d.fn.apply(d.scope?d.scope:this,"object"==typeof d.args&&d.args.length?d.args:[]))},s.onerror=s.onabort=function(e){var t,r,a=i.fallback,c=i.type,d=i.callback,h=!1;"js"==c?(t=document.getElementsByTagName("script")[0],(r=document.createElement("script")).type="text/javascript",r.src=a,r.defer=!0):"css"==c&&((r=document.createElement("link")).type="text/css",r.rel="stylesheet",r.href=a),r.onload=s.onreadystatechange=function(){h||this.readyState&&"complete"!=this.readyState||(h=!0,n(this),"function"==typeof d?d.call(this):"object"==typeof d&&"function"==typeof d.fn&&d.fn.apply(d.scope?d.scope:this,"object"==typeof d.args&&d.args.length?d.args:[]))},r.onerror=r.onabort=o,"css"==c?document.body.appendChild(r):t.parentNode.insertBefore(r,t)},"css"==c?document.body.appendChild(s):r.parentNode.insertBefore(s,r)})},loadResources:function(e){"use strict";for(var t,n=this,o=[],r=0,s=e.length;r<s;r++)t=n.loadResource(e[r]),o.push(t);return Promise.all(o)},sequence:function(e,t){"use strict";var n=this;return e.reduce(function(e,o){return e.then(function(e,n){return t(o)}.bind(n))}.bind(n),Promise.resolve())},load:function(){"use strict";var e=this,t=e.graph.steps();if(!t||!Array.isArray(t)||!t.length)throw new Error("nothing to load");return e.sequence(t,e.loadResources.bind(e)).then(function(e,t){},function(e){})}};